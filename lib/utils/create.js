import _pathOr from "ramda/src/pathOr";
import _dissocPath from "ramda/src/dissocPath";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import _forEach from "ramda/src/forEach";
import _propOr from "ramda/src/propOr";
import _includesInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/includes";
import _nth from "ramda/src/nth";
import _split from "ramda/src/split";
import _pipe from "ramda/src/pipe";
import _assocPath from "ramda/src/assocPath";
import _path from "ramda/src/path";
import _append from "ramda/src/append";
import _assoc from "ramda/src/assoc";
import _prop from "ramda/src/prop";
export var initState = {
  index: -1,
  stack: []
};
export var handleStackPop = function handleStackPop(state) {
  var stack = _prop('stack', state);

  stack.pop();
  var newIndex = _prop('index', state) - 1;
  state = _assoc('stack', stack, state);
  return _assoc('index', newIndex, state);
};
export var handleStackPush = function handleStackPush(state, action) {
  var stack = _prop('stack', state);

  var newIndex = _prop('index', state) + 1;
  state = _assoc('stack', _append({
    modelName: _path(['payload', 'modelName'], action)
  }, stack), state);
  state = _assoc('index', newIndex, state);
  return _assocPath(['stack', newIndex, 'fields'], {}, state);
};
export var clearFormStack = function clearFormStack() {
  return initState;
};
export var handleEnterFormStack = function handleEnterFormStack(state, action) {
  state = clearFormStack();

  var originPath = _path(['payload', 'path'], action);

  state = handleStackPush(state, action);
  return _assoc('originPath', originPath, state);
};
export var handleDetailCreate = function handleDetailCreate(schema, state, action) {
  var payload = _prop('payload', action);

  var node = _prop('node', payload);

  var targetInverseFieldName = _prop('targetInverseFieldName', payload);

  var getParentModelName = _pipe( // @ts-ignore
  _prop('path'), _split('/'), _nth(1));

  var parentModelName = getParentModelName(payload);
  var parentName = schema.getDisplayValue({
    modelName: parentModelName,
    node: node
  });

  var parentId = _prop('id', node);

  var type = schema.getType(_path(['payload', 'modelName'], action), targetInverseFieldName);
  var fieldData = {
    label: parentName,
    value: parentId,
    disabled: true
  };
  var prepopulatedField = _includesInstanceProperty(type).call(type, 'ToMany') ? [fieldData] : fieldData;
  state = _assocPath(['stack', 0, 'fields', targetInverseFieldName], prepopulatedField, handleEnterFormStack(state, action));
  state = _assoc('originModelName', parentModelName, state);
  state = _assoc('originFieldName', targetInverseFieldName, state);
  return _assoc('originNode', node, state);
};
export var handleCreateInputChange = function handleCreateInputChange(state, action) {
  var currentIndex = _prop('index', state);

  var payload = _prop('payload', action);

  return _assocPath(['stack', currentIndex, 'fields', payload.fieldName], payload.value, state);
};
export var handleValidationErrorCreate = function handleValidationErrorCreate(state, action) {
  var payload = _prop('payload', action);

  var stackIndex = _prop('index', state);

  var errors = _propOr([], 'errors', payload); // todo: check works


  _forEach(function (fieldNameError) {
    state = _assocPath(['stack', stackIndex, 'errors', fieldNameError], _prop(fieldNameError, errors), state);
  }, _Object$keys(errors));

  return state;
};
export var handleClearErrorSave = function handleClearErrorSave(state) {
  return _dissocPath(['stack', _prop('index', state), 'errors'], state);
};
export var selectCreate = function selectCreate(state) {
  return _pathOr(initState, ['conveyor', 'create'], state);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9jcmVhdGUudHMiXSwibmFtZXMiOlsiaW5pdFN0YXRlIiwiaW5kZXgiLCJzdGFjayIsImhhbmRsZVN0YWNrUG9wIiwic3RhdGUiLCJwb3AiLCJuZXdJbmRleCIsImhhbmRsZVN0YWNrUHVzaCIsImFjdGlvbiIsIm1vZGVsTmFtZSIsImNsZWFyRm9ybVN0YWNrIiwiaGFuZGxlRW50ZXJGb3JtU3RhY2siLCJvcmlnaW5QYXRoIiwiaGFuZGxlRGV0YWlsQ3JlYXRlIiwic2NoZW1hIiwicGF5bG9hZCIsIm5vZGUiLCJ0YXJnZXRJbnZlcnNlRmllbGROYW1lIiwiZ2V0UGFyZW50TW9kZWxOYW1lIiwicGFyZW50TW9kZWxOYW1lIiwicGFyZW50TmFtZSIsImdldERpc3BsYXlWYWx1ZSIsInBhcmVudElkIiwidHlwZSIsImdldFR5cGUiLCJmaWVsZERhdGEiLCJsYWJlbCIsInZhbHVlIiwiZGlzYWJsZWQiLCJwcmVwb3B1bGF0ZWRGaWVsZCIsImhhbmRsZUNyZWF0ZUlucHV0Q2hhbmdlIiwiY3VycmVudEluZGV4IiwiZmllbGROYW1lIiwiaGFuZGxlVmFsaWRhdGlvbkVycm9yQ3JlYXRlIiwic3RhY2tJbmRleCIsImVycm9ycyIsImZpZWxkTmFtZUVycm9yIiwiaGFuZGxlQ2xlYXJFcnJvclNhdmUiLCJzZWxlY3RDcmVhdGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBR0EsT0FBTyxJQUFNQSxTQUFTLEdBQUc7QUFDdkJDLEVBQUFBLEtBQUssRUFBRSxDQUFDLENBRGU7QUFFdkJDLEVBQUFBLEtBQUssRUFBRTtBQUZnQixDQUFsQjtBQUtQLE9BQU8sSUFBTUMsY0FBYyxHQUFHLFNBQWpCQSxjQUFpQixDQUFDQyxLQUFELEVBQWdCO0FBQzVDLE1BQU1GLEtBQUssR0FBRyxNQUFPLE9BQVAsRUFBZ0JFLEtBQWhCLENBQWQ7O0FBQ0FGLEVBQUFBLEtBQUssQ0FBQ0csR0FBTjtBQUNBLE1BQU1DLFFBQVEsR0FBRyxNQUFPLE9BQVAs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R0FBRyxRQUFTLEVBQVQsRUFBYSxRQUFiLEVBQXVCcEIsT0FBdkIsQ0FBdEIsQ0FIc0UsQ0FLdEU7OztBQUNBLFdBQVUsVUFBQXFCLGNBQWMsRUFBSTtBQUMxQmhDLElBQUFBLEtBQUssR0FBRyxXQUNOLENBQUMsT0FBRCxFQUFVOEIsVUFBVixFQUFzQixRQUF0QixFQUFnQ0UsY0FBaEMsQ0FETSxFQUVOLE1BQU9BLGNBQVAsRUFBOEJELE1BQTlCLENBRk0sRUFHTi9CLEtBSE0sQ0FBUjtBQUtELEdBTkQsRUFNRyxhQUFZK0IsTUFBWixDQU5IOztBQU9BLFNBQU8vQixLQUFQO0FBQ0QsQ0FkTTtBQWdCUCxPQUFPLElBQU1pQyxvQkFBb0IsR0FBRyxTQUF2QkEsb0JBQXVCLENBQUNqQyxLQUFELEVBQWdCO0FBQ2xELFNBQU8sWUFBYSxDQUFDLE9BQUQsRUFBVSxNQUFPLE9BQVAsRUFBZ0JBLEtBQWhCLENBQVYsRUFBa0MsUUFBbEMsQ0FBYixFQUEwREEsS0FBMUQsQ0FBUDtBQUNELENBRk07QUFJUCxPQUFPLElBQU1rQyxZQUFZLEdBQUcsU0FBZkEsWUFBZSxDQUFDbEMsS0FBRDtBQUFBLFNBQzFCLFFBQVNKLFNBQVQsRUFBb0IsQ0FBQyxVQUFELEVBQWEsUUFBYixDQUFwQixFQUE0Q0ksS0FBNUMsQ0FEMEI7QUFBQSxDQUFyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFIgZnJvbSAncmFtZGEnXG5pbXBvcnQgeyBTY2hlbWFCdWlsZGVyIH0gZnJvbSAnQGF1dG9pbnZlbnQvY29udmV5b3Itc2NoZW1hJ1xuXG5leHBvcnQgY29uc3QgaW5pdFN0YXRlID0ge1xuICBpbmRleDogLTEsXG4gIHN0YWNrOiBbXVxufVxuXG5leHBvcnQgY29uc3QgaGFuZGxlU3RhY2tQb3AgPSAoc3RhdGU6IGFueSkgPT4ge1xuICBjb25zdCBzdGFjayA9IFIucHJvcCgnc3RhY2snLCBzdGF0ZSlcbiAgc3RhY2sucG9wKClcbiAgY29uc3QgbmV3SW5kZXggPSBSLnByb3AoJ2luZGV4Jywgc3RhdGUpIC0gMVxuICBzdGF0ZSA9IFIuYXNzb2MoJ3N0YWNrJywgc3RhY2ssIHN0YXRlKVxuICByZXR1cm4gUi5hc3NvYygnaW5kZXgnLCBuZXdJbmRleCwgc3RhdGUpXG59XG5cbmV4cG9ydCBjb25zdCBoYW5kbGVTdGFja1B1c2ggPSAoc3RhdGU6IGFueSwgYWN0aW9uOiBhbnkpID0+IHtcbiAgY29uc3Qgc3RhY2sgPSBSLnByb3AoJ3N0YWNrJywgc3RhdGUpXG4gIGNvbnN0IG5ld0luZGV4ID0gUi5wcm9wKCdpbmRleCcsIHN0YXRlKSArIDFcbiAgc3RhdGUgPSBSLmFzc29jKFxuICAgICdzdGFjaycsXG4gICAgUi5hcHBlbmQoeyBtb2RlbE5hbWU6IFIucGF0aChbJ3BheWxvYWQnLCAnbW9kZWxOYW1lJ10sIGFjdGlvbikgfSwgc3RhY2spLFxuICAgIHN0YXRlXG4gIClcbiAgc3RhdGUgPSBSLmFzc29jKCdpbmRleCcsIG5ld0luZGV4LCBzdGF0ZSlcbiAgcmV0dXJuIFIuYXNzb2NQYXRoKFsnc3RhY2snLCBuZXdJbmRleCwgJ2ZpZWxkcyddLCB7fSwgc3RhdGUpXG59XG5cbmV4cG9ydCBjb25zdCBjbGVhckZvcm1TdGFjayA9ICgpID0+IHtcbiAgcmV0dXJuIGluaXRTdGF0ZVxufVxuXG5leHBvcnQgY29uc3QgaGFuZGxlRW50ZXJGb3JtU3RhY2sgPSAoc3RhdGU6IGFueSwgYWN0aW9uOiBhbnkpID0+IHtcbiAgc3RhdGUgPSBjbGVhckZvcm1TdGFjaygpXG4gIGNvbnN0IG9yaWdpblBhdGggPSBSLnBhdGgoWydwYXlsb2FkJywgJ3BhdGgnXSwgYWN0aW9uKVxuICBzdGF0ZSA9IGhhbmRsZVN0YWNrUHVzaChzdGF0ZSwgYWN0aW9uKVxuICByZXR1cm4gUi5hc3NvYygnb3JpZ2luUGF0aCcsIG9yaWdpblBhdGgsIHN0YXRlKVxufVxuXG5leHBvcnQgY29uc3QgaGFuZGxlRGV0YWlsQ3JlYXRlID0gKFxuICBzY2hlbWE6IFNjaGVtYUJ1aWxkZXIsXG4gIHN0YXRlOiBhbnksXG4gIGFjdGlvbjogYW55XG4pID0+IHtcbiAgY29uc3QgcGF5bG9hZCA9IFIucHJvcCgncGF5bG9hZCcsIGFjdGlvbilcbiAgY29uc3Qgbm9kZSA9IFIucHJvcCgnbm9kZScsIHBheWxvYWQpXG4gIGNvbnN0IHRhcmdldEludmVyc2VGaWVsZE5hbWUgPSBSLnByb3AoJ3RhcmdldEludmVyc2VGaWVsZE5hbWUnLCBwYXlsb2FkKVxuICBjb25zdCBnZXRQYXJlbnRNb2RlbE5hbWU6IChwYXlsb2FkOiBvYmplY3QpID0+IHN0cmluZyA9IFIucGlwZShcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgUi5wcm9wKCdwYXRoJyksXG4gICAgUi5zcGxpdCgnLycpLFxuICAgIFIubnRoKDEpXG4gIClcbiAgY29uc3QgcGFyZW50TW9kZWxOYW1lID0gZ2V0UGFyZW50TW9kZWxOYW1lKHBheWxvYWQpXG4gIGNvbnN0IHBhcmVudE5hbWUgPSBzY2hlbWEuZ2V0RGlzcGxheVZhbHVlKHtcbiAgICBtb2RlbE5hbWU6IHBhcmVudE1vZGVsTmFtZSxcbiAgICBub2RlXG4gIH0pXG4gIGNvbnN0IHBhcmVudElkID0gUi5wcm9wKCdpZCcsIG5vZGUpXG5cbiAgY29uc3QgdHlwZSA9IHNjaGVtYS5nZXRUeXBlKFxuICAgIFIucGF0aChbJ3BheWxvYWQnLCAnbW9kZWxOYW1lJ10sIGFjdGlvbikgYXMgc3RyaW5nLFxuICAgIHRhcmdldEludmVyc2VGaWVsZE5hbWVcbiAgKVxuICBjb25zdCBmaWVsZERhdGEgPSB7XG4gICAgbGFiZWw6IHBhcmVudE5hbWUsXG4gICAgdmFsdWU6IHBhcmVudElkLFxuICAgIGRpc2FibGVkOiB0cnVlXG4gIH1cbiAgY29uc3QgcHJlcG9wdWxhdGVkRmllbGQgPSB0eXBlLmluY2x1ZGVzKCdUb01hbnknKSA/IFtmaWVsZERhdGFdIDogZmllbGREYXRhXG4gIHN0YXRlID0gUi5hc3NvY1BhdGgoXG4gICAgWydzdGFjaycsIDAsICdmaWVsZHMnLCB0YXJnZXRJbnZlcnNlRmllbGROYW1lXSxcbiAgICBwcmVwb3B1bGF0ZWRGaWVsZCxcbiAgICBoYW5kbGVFbnRlckZvcm1TdGFjayhzdGF0ZSwgYWN0aW9uKVxuICApXG4gIHN0YXRlID0gUi5hc3NvYygnb3JpZ2luTW9kZWxOYW1lJywgcGFyZW50TW9kZWxOYW1lLCBzdGF0ZSlcbiAgc3RhdGUgPSBSLmFzc29jKCdvcmlnaW5GaWVsZE5hbWUnLCB0YXJnZXRJbnZlcnNlRmllbGROYW1lLCBzdGF0ZSlcbiAgcmV0dXJuIFIuYXNzb2MoJ29yaWdpbk5vZGUnLCBub2RlLCBzdGF0ZSlcbn1cblxuZXhwb3J0IGNvbnN0IGhhbmRsZUNyZWF0ZUlucHV0Q2hhbmdlID0gKHN0YXRlOiBhbnksIGFjdGlvbjogYW55KSA9PiB7XG4gIGNvbnN0IGN1cnJlbnRJbmRleCA9IFIucHJvcCgnaW5kZXgnLCBzdGF0ZSlcbiAgY29uc3QgcGF5bG9hZCA9IFIucHJvcCgncGF5bG9hZCcsIGFjdGlvbilcbiAgcmV0dXJuIFIuYXNzb2NQYXRoKFxuICAgIFsnc3RhY2snLCBjdXJyZW50SW5kZXgsICdmaWVsZHMnLCBwYXlsb2FkLmZpZWxkTmFtZV0sXG4gICAgcGF5bG9hZC52YWx1ZSxcbiAgICBzdGF0ZVxuICApXG59XG5cbmV4cG9ydCBjb25zdCBoYW5kbGVWYWxpZGF0aW9uRXJyb3JDcmVhdGUgPSAoc3RhdGU6IGFueSwgYWN0aW9uOiBhbnkpID0+IHtcbiAgY29uc3QgcGF5bG9hZCA9IFIucHJvcCgncGF5bG9hZCcsIGFjdGlvbilcbiAgY29uc3Qgc3RhY2tJbmRleCA9IFIucHJvcCgnaW5kZXgnLCBzdGF0ZSlcbiAgY29uc3QgZXJyb3JzOiBhbnlbXSA9IFIucHJvcE9yKFtdLCAnZXJyb3JzJywgcGF5bG9hZClcblxuICAvLyB0b2RvOiBjaGVjayB3b3Jrc1xuICBSLmZvckVhY2goZmllbGROYW1lRXJyb3IgPT4ge1xuICAgIHN0YXRlID0gUi5hc3NvY1BhdGgoXG4gICAgICBbJ3N0YWNrJywgc3RhY2tJbmRleCwgJ2Vycm9ycycsIGZpZWxkTmFtZUVycm9yXSxcbiAgICAgIFIucHJvcChmaWVsZE5hbWVFcnJvciBhcyBhbnksIGVycm9ycyksXG4gICAgICBzdGF0ZVxuICAgIClcbiAgfSwgT2JqZWN0LmtleXMoZXJyb3JzKSlcbiAgcmV0dXJuIHN0YXRlXG59XG5cbmV4cG9ydCBjb25zdCBoYW5kbGVDbGVhckVycm9yU2F2ZSA9IChzdGF0ZTogYW55KSA9PiB7XG4gIHJldHVybiBSLmRpc3NvY1BhdGgoWydzdGFjaycsIFIucHJvcCgnaW5kZXgnLCBzdGF0ZSksICdlcnJvcnMnXSwgc3RhdGUpXG59XG5cbmV4cG9ydCBjb25zdCBzZWxlY3RDcmVhdGUgPSAoc3RhdGU6IGFueSkgPT5cbiAgUi5wYXRoT3IoaW5pdFN0YXRlLCBbJ2NvbnZleW9yJywgJ2NyZWF0ZSddLCBzdGF0ZSlcbiJdfQ==